<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision AI - An√°lise de V√≠deo e Imagem</title>
    
    <!-- Pico CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    
    <!-- PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="styles.css?v=3">
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div>üêç Carregando PyScript...</div>
    </div>

    <main class="container">
        <header>
            <h1>
                Vision AI
                <span class="pyscript-badge">PyScript</span>
                <span id="recordingIndicator" class="recording-indicator hidden">‚óè REC</span>
            </h1>
        </header>

        <!-- Sistema de Abas -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="webcam">üì∑ Webcam</button>
            <button class="tab-btn" data-tab="video">üé¨ V√≠deo Local</button>
            <button class="tab-btn" data-tab="image">üñºÔ∏è Imagem</button>
        </nav>

        <!-- Conte√∫do das Abas -->
        <div class="tab-content">
            
            <!-- Aba Webcam -->
            <article id="tab-webcam" class="tab-panel active">
                <label>
                    üì∑ C√¢mera
                    <select id="cameraSelect" name="Camera">
                        <option value="">Carregando c√¢meras...</option>
                    </select>
                </label>
                <video id="videoFeed" autoplay playsinline></video>
                <canvas id="canvas" class="hidden"></canvas>
                
                <!-- Op√ß√£o de Grava√ß√£o -->
                <fieldset>
                    <label>
                        <input type="checkbox" id="enableRecording" name="enableRecording">
                        Gravar v√≠deo com legendas
                    </label>
                </fieldset>
                
                <!-- Bot√µes de Download (ocultos por padr√£o) -->
                <div id="downloadSection" class="download-section hidden">
                    <p><strong>Grava√ß√£o conclu√≠da!</strong> Baixe os arquivos:</p>
                    <div class="grid">
                        <button id="downloadVideo" class="secondary">
                            üìπ Download V√≠deo (.webm)
                        </button>
                        <button id="downloadCaptions" class="secondary">
                            üìù Download Legendas (.srt)
                        </button>
                    </div>
                </div>
            </article>
            
            <!-- Aba V√≠deo Local -->
            <article id="tab-video" class="tab-panel hidden">
                <div class="file-upload-area" id="videoDropZone">
                    <input type="file" id="videoFileInput" accept="video/*" class="hidden">
                    <label for="videoFileInput" class="upload-label">
                        <span class="upload-icon">üé¨</span>
                        <span>Arraste um v√≠deo aqui ou clique para selecionar</span>
                        <span class="upload-hint">Formatos: MP4, WebM, MOV, AVI</span>
                    </label>
                </div>
                
                <div id="videoPlayerContainer" class="hidden">
                    <video id="localVideo" class="local-video"></video>
                    <canvas id="localVideoCanvas" class="hidden"></canvas>
                    
                    <!-- Timeline -->
                    <div class="video-timeline">
                        <input type="range" id="videoTimeline" min="0" max="100" value="0" step="0.1">
                        <div class="time-display">
                            <span id="currentTime">00:00</span>
                            <span>/</span>
                            <span id="totalTime">00:00</span>
                        </div>
                    </div>
                    
                    <!-- Controles do Player -->
                    <div class="player-controls">
                        <div class="controls-left">
                            <button id="prevFrame" class="control-btn" title="Frame anterior">‚èÆÔ∏è</button>
                            <button id="rewind" class="control-btn" title="Retroceder 5s">‚è™</button>
                            <button id="playPause" class="control-btn primary" title="Play/Pause">‚ñ∂Ô∏è</button>
                            <button id="stopVideo" class="control-btn" title="Parar">‚èπÔ∏è</button>
                            <button id="forward" class="control-btn" title="Avan√ßar 5s">‚è©</button>
                            <button id="nextFrame" class="control-btn" title="Pr√≥ximo frame">‚è≠Ô∏è</button>
                        </div>
                        <div class="controls-right">
                            <select id="playbackSpeed" class="speed-select">
                                <option value="0.25">0.25x</option>
                                <option value="0.5">0.5x</option>
                                <option value="1" selected>1x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2x</option>
                            </select>
                            <button id="changeVideo" class="control-btn secondary" title="Trocar v√≠deo">üìÅ</button>
                        </div>
                    </div>
                    
                    <!-- Download de Legendas do V√≠deo Local -->
                    <div id="videoDownloadSection" class="download-section hidden">
                        <p><strong>An√°lise conclu√≠da!</strong></p>
                        <button id="downloadVideoSrt" class="secondary">
                            üìù Download Legendas (.srt)
                        </button>
                    </div>
                </div>
            </article>
            
            <!-- Aba Imagem -->
            <article id="tab-image" class="tab-panel hidden">
                <div class="file-upload-area" id="imageDropZone">
                    <input type="file" id="imageFileInput" accept="image/*" class="hidden">
                    <label for="imageFileInput" class="upload-label">
                        <span class="upload-icon">üñºÔ∏è</span>
                        <span>Arraste uma imagem aqui ou clique para selecionar</span>
                        <span class="upload-hint">Formatos: JPG, PNG, WebP, GIF</span>
                    </label>
                </div>
                
                <div id="imageViewerContainer" class="hidden">
                    <img id="loadedImage" class="loaded-image" alt="Imagem carregada">
                    <canvas id="imageCanvas" class="hidden"></canvas>
                    
                    <div class="image-controls">
                        <button id="analyzeImage" class="primary">üîç Analisar Imagem</button>
                        <button id="changeImage" class="secondary">üìÅ Trocar Imagem</button>
                    </div>
                </div>
            </article>
        </div>

        <!-- Controles Comuns -->
        <article class="common-controls">
            <div class="grid">
                <label>
                    Provedor da API
                    <select id="apiProvider" name="API Provider">
                        <option value="llamacpp">llama.cpp</option>
                        <option value="lmstudio" selected>LM Studio</option>
                    </select>
                </label>
                <label>
                    Base API
                    <input type="text" id="baseURL" name="Base URL" value="http://localhost:1234">
                </label>
            </div>

            <label>
                Instruction
                <textarea id="instructionText" name="Instruction" rows="2">What do you see?</textarea>
            </label>

            <label>
                Response
                <textarea id="responseText" name="Response" rows="2" readonly placeholder="Server response will appear here..."></textarea>
            </label>

            <div class="grid">
                <label>
                    Intervalo entre requisi√ß√µes
                    <select id="intervalSelect" name="Interval">
                        <option value="100">100ms</option>
                        <option value="250">250ms</option>
                        <option value="500" selected>500ms</option>
                        <option value="1000">1s</option>
                        <option value="2000">2s</option>
                    </select>
                </label>
                <div class="button-container">
                    <button id="startButton" class="start">Start</button>
                </div>
            </div>
        </article>
    </main>

    <script type="py" src="camera_app.py?v=4"></script>
</body>
</html>
